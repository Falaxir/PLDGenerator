\documentclass[12pt]{extarticle}
\usepackage{svg}
\usepackage{amsmath}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{hyperref}
\usepackage{tgbonum}
\usepackage{tabularx}
\usepackage{colortbl}
\usepackage{geometry}
\usepackage{environ}
\usepackage{calc}
\usepackage{needspace}
\usepackage{tocbibind}
\usepackage{xcolor}
\usepackage[linguistics]{forest}
\usetikzlibrary{fit}

\raggedbottom
\newlength\chunktotheight
\NewEnviron{chunk}[1]{
    \settototalheight{\chunktotheight}{
        \begin{minipage}{\textwidth}
        \BODY
        \end{minipage}
    }
    \ifdim\chunktotheight>\textheight
    \else
    \needspace{\chunktotheight}
    \fi
    \def\temp{#1}\ifx\temp\empty\else
        \addtocounter{#1}{-1}
    \fi
    \BODY
}{}
\geometry{a4paper,total={170mm,257mm},left=20mm,top=20mm,}
\setcounter{secnumdepth}{0}
\newcommand{\rowWidth}{\linewidth-(\tabcolsep*2)}

\renewcommand{\familydefault}{\sfdefault}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\fancyhf{}
\lhead{\includesvg[width = 20pt]{logo.svg}}
\rhead{\Large Project Log Document}
\rfoot{Page \thepage \space of \pageref{LastPage}}
\lfoot{\includesvg[width = 100pt]{sublogo.svg}}

\fancypagestyle{plain}{
    \renewcommand{\headrulewidth}{0pt}
    \fancyhf{}
    \rfoot{Page \thepage \space of \pageref{LastPage}}
    \lfoot{\includesvg[width = 100pt]{sublogo.svg}}
}
\renewcommand*\contentsname{Table des matières}
\title{D4DATA PLD - Project Log Document}
\date{}
\author{}

\begin{document}
\clearpage
\vspace*{\fill}
\begin{center}
\begin{figure}[htbp]
	\centering
	\includesvg{logo.svg}
	\item\maketitle
\end{figure}
\vspace{4cm}
\textbf{\Large Promotion 2022}
\end{center}

\vfill
\clearpage

\begin{chunk}{}
\section{Description du document}
\renewcommand{\arraystretch}{1.4}
\begin{tabularx}{\textwidth}{|l|X|}
	\hline \cellcolor[gray]{0.9}Titre & D4DATA Project Log Document\\
	\hline \cellcolor[gray]{0.9}Description & Document décrivant l’évolution du projet D4Data sur le sprint 2\\
	\hline \cellcolor[gray]{0.9}Auteur & Clovis de Villars, Pedro Da Fonseca, Jessy Sobreiro, Nathan Bonnot, Hervé Vaterlaus, Valentin Szabo\\
	\hline \cellcolor[gray]{0.9}Date de mise à jour & 24/07/20\\
	\hline \cellcolor[gray]{0.9}Version du modèle & 1.0.1\\
	\hline
\end{tabularx}
\end{chunk}

\begin{chunk}{}
\section{Tableau des révisions}
\renewcommand{\arraystretch}{1.4}
\begin{tabularx}{\textwidth}{|l|l|X|X|X|}
	\hline \rowcolor[gray]{0.9}Date & Version & Auteur & Sections & Commentaire\\
	\hline 19/07/20 & 1.0.0 & Clovis & Toutes & Première version\\
	\hline 24/07/20 & 1.0.1 & Jessy & Toutes & Première version\\
	\hline
\end{tabularx}
\end{chunk}

\setcounter{secnumdepth}{50}
\setcounter{tocdepth}{50}
\renewcommand*\contentsname{Table des matières}

\clearpage
\tableofcontents
\clearpage

\begin{chunk}{section}
    \section{Organigramme des livrables}
    \centering
    \begin{forest}
    	for tree={draw, align=center, l=15mm},
    	[D4DATA
    		[1 Interface]
    		[2 Traitements\\des\\archives]
    		[3 Extension\\navigateur]
    		[4 Support de\\Facebook]
    		[5 Support de\\Discord]
    		[6 Support de\\Reddit]
    		[7 Intégration\\continue]
    		[8 Organisation]
    	]
    \end{forest}
\end{chunk}

\section{Carte des livrables}
\begin{chunk}{subsection}
    \subsection{Interface}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|X|X|}
    	\hline \multicolumn{3}{|c|}{\cellcolor[gray]{0.9}Interface}\\
    	\hline 1 Composants & 2 Pages & 3 Tableau de bord\\
    	\hline 1.1 Composant accès rapide historique d'archive & 2.1 Page liste d'historique d'archive & \\
    	\hline 1.2 Composant historique d'archive &  & \\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Traitements des archives}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|X|}
    	\hline \multicolumn{2}{|c|}{\cellcolor[gray]{0.9}Traitements des archives}\\
    	\hline 1 Historique des archives traitées & 2 Définition du format standard v1.1\\
    	\hline 1.1 Historique des archives & 2.1 Schéma JSON Mail\\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Extension navigateur}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|X|}
    	\hline \multicolumn{2}{|c|}{\cellcolor[gray]{0.9}Extension navigateur}\\
    	\hline 1 Consentement utilisateur & 2 Récupération automatique de l'archive Facebook\\
    	\hline 1.1 Récupération du consentement utilisateur & 2.1 Récupération automatique de l'archive Facebook\\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Support de Facebook}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|}
    	\hline \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}Support de Facebook}\\
    	\hline 1 Plugin\\
    	\hline 1.1 Fixer l’encodage des données Facebook\\
    	\hline 1.2 Extraction des abonnements\\
    	\hline 1.3 Extraction des suivis\\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Support de Discord}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|}
    	\hline \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}Support de Discord}\\
    	\hline 1 Plugin\\
    	\hline 1.1 Extraction du profil\\
    	\hline 1.2 Extraction des chats\\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Support de Reddit}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|}
    	\hline \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}Support de Reddit}\\
    	\hline 1 Plugin\\
    	\hline 1.1 Extraction du profil\\
    	\hline 1.2 Extraction des communautés\\
    	\hline 1.3 Extraction des contacts\\
    	\hline 1.4 Extraction des posts\\
    	\hline 1.5 Extraction des votes\\
    	\hline 1.6 Extraction des paramètres\\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Intégration continue}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|X|}
    	\hline \multicolumn{2}{|c|}{\cellcolor[gray]{0.9}Intégration continue}\\
    	\hline 1 Github actions & 2 Pipeline automatisée de gestion du PLD\\
    	\hline 1.1 Création automatique de release & \\
    	\hline
    \end{tabularx}
\end{chunk}

\begin{chunk}{subsection}
    \subsection{Organisation}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|}
    	\hline \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}Organisation}\\
    	\hline 1 PLD\\
    	\hline 1.1 Schéma JSON PLD\\
    	\hline 1.2 PLD CLI\\
    	\hline 1.3 Génération automatique du PLD\\
    	\hline
    \end{tabularx}
\end{chunk}

\clearpage
\section{User stories}

\subsection{Interface}
\subsubsection{Composants}
\paragraph{Composant accès rapide historique d'archive}\mbox{}\\

\begin{chunk}{}
    \renewcommand{\arraystretch}{1.4}
    \begin{tabularx}{\textwidth}{|X|X|}
    	\hline \multicolumn{2}{|>{\columncolor[gray]{0.9}\centering}m{\rowWidth}|}{\textbf{Composant accès rapide historique d'archive}}\\
    	\hline \rowcolor[gray]{0.95}En tant que : & Je veux :\\
    	\hline Utilisateur lambda & Pouvoir visualiser et restaurer les dernières archives traitées\\
    	\hline \multicolumn{2}{|>{\columncolor[gray]{0.9}}p{\rowWidth}|}{Description :\\Composant réutilisable qui affiche les 2 dernières archive traitées et qui permet des les retaurer. Sera affiché sur la page d'accueil.}\\
    	\hline \multicolumn{2}{|p{\rowWidth}|}{Definition of Done : 
    	\begin{itemize}
    		\item Maquette du composant
    		\item Composant réutilisable affichant les 2 dernières archives traitée
    		\item Un bouton restaurer sur chaque archive
    		\item Si il n'y a pas d'archive dans l'historique un message est affiché
    	\end{itemize}}\\
    	\hline \rowcolor[gray]{0.9}Charge estimée : & 2 jours-homme (16 heures)\\
    	\hline
    \end{tabularx}
\end{chunk}

\end{document}
